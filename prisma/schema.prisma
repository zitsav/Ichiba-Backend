generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId           Int             @id @default(autoincrement())
  name             String
  enrollmentNumber String          @unique
  isVerified       Boolean         @default(false)
  program          String
  batchYear        Int
  batch            String
  upiId            String?
  phoneNumber      String?
  products         Product[]       @relation("ProductOwner")
  userLikes        ProductLike[]   @relation("UserLikedProducts")
  profilePicture   ProfilePicture? @relation("UserProfilePicture")
}

model Product {
  productId    Int            @id @default(autoincrement())
  name         String
  description  String
  owner        User           @relation("ProductOwner", fields: [ownerId], references: [userId])
  ownerId      Int
  category     Category
  price        Float
  likes        Int            @default(0)
  images       ProductImage[] @relation("ProductImages")
  isSold       Boolean        @default(false)
  productLikes ProductLike[]  @relation("ProductLikes")
  createdAt    DateTime       @default(now())
}

model ProfilePicture {
  id       Int    @id @default(autoincrement())
  publicID String
  url      String
  user     User   @relation("UserProfilePicture", fields: [userId], references: [userId])
  userId   Int    @unique
}

model ProductImage {
  id        Int     @id @default(autoincrement())
  publicID  String
  url       String
  product   Product @relation("ProductImages", fields: [productId], references: [productId])
  productId Int
}

model ProductLike {
  id        Int     @id @default(autoincrement())
  user      User    @relation("UserLikedProducts", fields: [userId], references: [userId])
  userId    Int
  product   Product @relation("ProductLikes", fields: [productId], references: [productId])
  productId Int

  @@unique([userId, productId], name: "UserProductLikeCompositeKey")
}

enum Category {
  ELECTRONICS
  COOLER
  BOOKS
  MATTRESS
  OTHERS
}